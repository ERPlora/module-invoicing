{% load static i18n ui component_tags %}

{# Toast listener for HX-Trigger events #}
<script>
(function() {
    if (!window._invoicingToastListenerAdded) {
        window._invoicingToastListenerAdded = true;
        document.body.addEventListener('showToast', function(e) {
            var detail = e.detail || {};
            var message = detail.message || 'Done';
            var color = detail.color || 'success';

            var toast = document.createElement('ion-toast');
            toast.message = message;
            toast.duration = 2000;
            toast.position = 'top';
            toast.color = color;
            document.body.appendChild(toast);
            toast.present();
        });
    }
})();
</script>

{% component "settings_page"
    title=_("Invoicing Settings")
    subtitle=_("Configure invoicing module behavior and company data")
    module_id="invoicing"
    tabbar_view="settings" %}

    {% fill "settings" %}
        {% csrf_token %}

        {% component "setting_section" title=_("Company Information") description=_("This information will appear on your invoices") %}
            {% component "setting_input"
                name="company_name"
                title=_("Company Name")
                description=_("Your business name for invoices")
                value=config.company_name
                type="text"
                placeholder="Your Company Name" %}{% endcomponent %}

            {% component "setting_input"
                name="company_tax_id"
                title=_("Tax ID (NIF/CIF)")
                description=_("Tax identification number")
                value=config.company_tax_id
                type="text"
                placeholder="B12345678" %}{% endcomponent %}

            {% component "setting_textarea"
                name="company_address"
                title=_("Address")
                description=_("Company address for invoices")
                value=config.company_address
                placeholder="Street, City, Postal Code"
                rows=2 %}{% endcomponent %}

            {% component "setting_input"
                name="company_phone"
                title=_("Phone")
                description=_("Contact phone number")
                value=config.company_phone
                type="tel"
                placeholder="+34 600 000 000" %}{% endcomponent %}

            {% component "setting_input"
                name="company_email"
                title=_("Email")
                description=_("Contact email address")
                value=config.company_email
                type="email"
                placeholder="info@company.com" %}{% endcomponent %}
        {% endcomponent %}

        {% component "setting_section" title=_("Invoice Settings") %}
            {% component "setting_select"
                name="default_series"
                title=_("Default Series")
                description=_("Series used for new invoices")
                value=config.default_series
                options=series_options
                placeholder="Select series" %}{% endcomponent %}

            {% component "setting_toggle"
                name="auto_generate_invoice"
                title=_("Auto Generate Invoice")
                description=_("Automatically create invoice after sale")
                checked=config.auto_generate_invoice
                hx_post="/modules/invoicing/settings/toggle/" %}{% endcomponent %}

            {% component "setting_toggle"
                name="require_customer"
                title=_("Require Customer")
                description=_("Customer is mandatory for invoices")
                checked=config.require_customer
                color="warning"
                hx_post="/modules/invoicing/settings/toggle/" %}{% endcomponent %}
        {% endcomponent %}

        {% component "setting_section" title=_("Invoice Footer") description=_("Text that appears at the bottom of invoices") %}
            {% component "setting_textarea"
                name="invoice_footer"
                title=_("Footer Text")
                description=_("Payment terms, legal information, thank you message")
                value=config.invoice_footer
                placeholder="Payment terms, legal information, thank you message..."
                rows=3 %}{% endcomponent %}
        {% endcomponent %}
    {% endfill %}

    {% fill "actions" %}
        <div class="mt-lg pt-md" style="border-top: 1px solid var(--border-color);">
            <ion-button
                color="medium"
                fill="outline"
                expand="block"
                hx-post="{% url 'invoicing:settings_reset' %}"
                hx-confirm="{% trans 'Reset all settings to defaults?' %}"
                hx-target="#main-content-area"
                hx-include="[name='csrfmiddlewaretoken']">
                <ion-icon slot="start" name="refresh-outline"></ion-icon>
                {% trans "Reset to Defaults" %}
            </ion-button>
        </div>

        <!-- Info Section -->
        <div class="mt-md p-md rounded-lg" style="background: var(--ion-color-step-50);">
            <div class="flex items-start gap-2">
                <ion-icon name="information-circle-outline" style="font-size: 20px; color: var(--ion-color-primary); margin-top: 2px;"></ion-icon>
                <p class="text-sm m-0" style="color: var(--ion-color-medium);">
                    {% trans "Company information will be displayed on all invoices. Make sure the Tax ID is correct for legal compliance. To manage invoice series, go to the Series tab." %}
                </p>
            </div>
        </div>
    {% endfill %}
{% endcomponent %}
