{% load djicons i18n djicons djicons %}

<div class="p-4">
    <!-- Company Information -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "business-outline" css_class="text-primary" %} {% trans "Company Information" %}</h3>
            <p class="text-sm text-base-content/60">{% trans "This information will appear on your invoices" %}</p>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Company Name" %}</div>
                    <div class="list-item-note">{% trans "Legal business name" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="text" name="company_name"
                           value="{{ settings.company_name }}"
                           class="input input-sm"
                           style="width: 220px;"
                           placeholder="{% trans 'Your Company Name' %}"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "company_name", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Tax ID (NIF/CIF)" %}</div>
                    <div class="list-item-note">{% trans "Company tax identification" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="text" name="company_tax_id"
                           value="{{ settings.company_tax_id }}"
                           class="input input-sm"
                           style="width: 180px;"
                           placeholder="B12345678"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "company_tax_id", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Address" %}</div>
                    <div class="list-item-note">{% trans "Street, City, Postal Code" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="text" name="company_address"
                           value="{{ settings.company_address }}"
                           class="input input-sm"
                           style="width: 280px;"
                           placeholder="{% trans 'Street, City, Postal Code' %}"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "company_address", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Phone" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="tel" name="company_phone"
                           value="{{ settings.company_phone }}"
                           class="input input-sm"
                           style="width: 180px;"
                           placeholder="+34 600 000 000"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "company_phone", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Email" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="email" name="company_email"
                           value="{{ settings.company_email }}"
                           class="input input-sm"
                           style="width: 220px;"
                           placeholder="info@company.com"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "company_email", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Behavior -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "settings-outline" css_class="text-warning" %} {% trans "Invoice Behavior" %}</h3>
        </div>
        <div class="list">
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Default Series Prefix" %}</div>
                    <div class="list-item-note">{% trans "Default prefix for new invoice series" %}</div>
                </div>
                <div class="list-item-end">
                    <input type="text" name="default_series_prefix"
                           value="{{ settings.default_series_prefix }}"
                           class="input input-sm"
                           style="width: 80px; text-transform: uppercase;"
                           maxlength="10"
                           hx-post="{% url 'invoicing:settings_input' %}"
                           hx-vals='js:{field: "default_series_prefix", value: event.target.value}'
                           hx-trigger="change"
                           hx-swap="none">
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Auto Generate Invoice" %}</div>
                    <div class="list-item-note">{% trans "Automatically create invoice after a sale" %}</div>
                </div>
                <div class="list-item-end">
                    <label class="toggle color-success">
                        <input type="checkbox" name="auto_generate_invoice"
                               {% if settings.auto_generate_invoice %}checked{% endif %}
                               hx-post="{% url 'invoicing:settings_toggle' %}"
                               hx-vals='js:{field: "auto_generate_invoice"}'
                               hx-swap="none">
                        <span class="toggle-track"><span class="toggle-thumb"></span></span>
                    </label>
                </div>
            </div>
            <div class="list-item">
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Require Customer" %}</div>
                    <div class="list-item-note">{% trans "Customer data is mandatory for invoices" %}</div>
                </div>
                <div class="list-item-end">
                    <label class="toggle color-success">
                        <input type="checkbox" name="require_customer"
                               {% if settings.require_customer %}checked{% endif %}
                               hx-post="{% url 'invoicing:settings_toggle' %}"
                               hx-vals='js:{field: "require_customer"}'
                               hx-swap="none">
                        <span class="toggle-track"><span class="toggle-thumb"></span></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Footer -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "document-text-outline" css_class="text-success" %} {% trans "Invoice Footer" %}</h3>
            <p class="text-sm text-base-content/60">{% trans "Text that appears at the bottom of printed invoices" %}</p>
        </div>
        <div class="card-body">
            <textarea name="invoice_footer"
                class="textarea"
                rows="3"
                placeholder="{% trans 'Payment terms, legal information, thank you message...' %}"
                hx-post="{% url 'invoicing:settings_input' %}"
                hx-vals='js:{field: "invoice_footer", value: event.target.value}'
                hx-trigger="change"
                hx-swap="none">{{ settings.invoice_footer }}</textarea>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "link-outline" %} {% trans "Quick Actions" %}</h3>
        </div>
        <div class="list">
            <a hx-get="{% url 'invoicing:series' %}"
               hx-target="#main-content-area"
               hx-push-url="true"
               class="list-item list-item-clickable">
                <div class="list-item-start">{% icon "layers-outline" css_class="text-primary" %}</div>
                <div class="list-item-content">
                    <div class="list-item-label">{% trans "Invoice Series" %}</div>
                    <div class="list-item-note">{% trans "Manage numbering sequences" %}</div>
                </div>
                <div class="list-item-end">
                    <span class="list-item-chevron"></span>
                </div>
            </a>
        </div>
    </div>

    <!-- Reset -->
    <div class="card" style="border-color: var(--color-warning)">
        <div class="card-header">
            <h3 class="card-title text-warning">{% trans "Reset Settings" %}</h3>
        </div>
        <div class="card-body">
            <p class="text-base-content/60 mb-3">{% trans "Restore all invoicing settings to their default values." %}</p>
            <button type="button" class="btn btn-outline color-warning"
                    onclick="resetSettings()">
                {% icon "refresh-outline" %} {% trans "Reset to Defaults" %}
            </button>
        </div>
    </div>
</div>

<script>
function resetSettings() {
    if (!confirm('{% trans "Reset all invoicing settings to their default values?" %}')) return;
    fetch('{% url "invoicing:settings_reset" %}', {
        method: 'POST',
        headers: {'X-CSRFToken': '{{ csrf_token }}'}
    }).then(r => {
        if (r.ok) htmx.ajax('GET', '{% url "invoicing:settings" %}', '#main-content-area');
    });
}
</script>
