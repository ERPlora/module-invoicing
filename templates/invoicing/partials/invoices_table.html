{% load i18n %}

<div class="scroll-ios scroll-list" style="max-height: calc(100vh - 400px);">
    <table class="w-full">
        <thead style="position: sticky; top: 0; z-index: 10;">
            <tr style="background: var(--ion-color-light);">
                <th class="p-3 text-left text-sm font-medium">{% trans "Number" %}</th>
                <th class="p-3 text-left text-sm font-medium">{% trans "Customer" %}</th>
                <th class="p-3 text-left text-sm font-medium">{% trans "Date" %}</th>
                <th class="p-3 text-right text-sm font-medium">{% trans "Total" %}</th>
                <th class="p-3 text-center text-sm font-medium">{% trans "Status" %}</th>
                <th class="p-3 text-center text-sm font-medium">{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody id="invoices-tbody">
            {% for invoice in invoices %}
            <tr style="border-bottom: 1px solid var(--ion-border-color);">
                <td class="p-3">
                    <span class="font-medium">{{ invoice.number|default:_("Draft") }}</span>
                </td>
                <td class="p-3">
                    <div>{{ invoice.customer_name }}</div>
                    {% if invoice.customer_tax_id %}
                    <div class="text-xs" style="color: var(--ion-color-medium);">{{ invoice.customer_tax_id }}</div>
                    {% endif %}
                </td>
                <td class="p-3">{{ invoice.issue_date|date:"Y-m-d" }}</td>
                <td class="p-3 text-right font-medium">EUR{{ invoice.total }}</td>
                <td class="p-3 text-center">
                    {% if invoice.status == 'draft' %}
                    <ion-badge color="medium">{% trans "Draft" %}</ion-badge>
                    {% elif invoice.status == 'issued' %}
                    <ion-badge color="primary">{% trans "Issued" %}</ion-badge>
                    {% elif invoice.status == 'paid' %}
                    <ion-badge color="success">{% trans "Paid" %}</ion-badge>
                    {% elif invoice.status == 'cancelled' %}
                    <ion-badge color="danger">{% trans "Cancelled" %}</ion-badge>
                    {% endif %}
                </td>
                <td class="p-3 text-center">
                    <ion-button size="small" fill="clear"
                        hx-get="{% url 'invoicing:invoice_detail' invoice.id %}"
                        hx-target="#main-content-area"
                        hx-push-url="true">
                        <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
                    </ion-button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center py-12">
                    <ion-icon name="document-text-outline" style="font-size: 64px; color: var(--ion-color-medium);"></ion-icon>
                    <p class="mt-4" style="color: var(--ion-color-medium);">{% trans "No invoices found" %}</p>
                    <ion-button class="mt-4"
                        hx-get="{% url 'invoicing:invoice_create' %}"
                        hx-target="#main-content-area"
                        hx-push-url="true">
                        <ion-icon slot="start" name="add-outline"></ion-icon>
                        {% trans "Create First Invoice" %}
                    </ion-button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Infinite scroll trigger -->
    {% if has_next %}
    <div class="infinite-scroll-loader"
         hx-get="{{ request.path }}?page={{ next_page }}{% if search %}&search={{ search }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}&per_page={{ per_page }}"
         hx-trigger="revealed"
         hx-target="#invoices-tbody"
         hx-swap="beforeend"
         hx-select="#invoices-tbody > tr, .infinite-scroll-loader, .infinite-scroll-end">
        <ion-spinner name="crescent"></ion-spinner>
    </div>
    {% else %}
    {% if total_count > 0 %}
    <div class="infinite-scroll-end">
        {% blocktrans count count=total_count %}{{ count }} invoice{% plural %}{{ count }} invoices{% endblocktrans %}
    </div>
    {% endif %}
    {% endif %}
</div>
