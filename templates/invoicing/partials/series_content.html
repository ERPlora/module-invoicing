{% load static i18n ui component_tags %}

{# Toast listener for HX-Trigger events #}
<script>
(function() {
    if (!window._invoicingToastListenerAdded) {
        window._invoicingToastListenerAdded = true;
        document.body.addEventListener('showToast', function(e) {
            var detail = e.detail || {};
            var message = detail.message || 'Done';
            var color = detail.color || 'success';

            var toast = document.createElement('ion-toast');
            toast.message = message;
            toast.duration = 2000;
            toast.position = 'top';
            toast.color = color;
            document.body.appendChild(toast);
            toast.present();
        });
    }
})();
</script>

{% component "page"
    title=_("Invoice Series")
    module_id="invoicing"
    tabbar_view="series"
    action_icon="add-outline"
    action_label=_("New Series")
    action_url="/modules/invoicing/series/create/" %}

    {% fill "content" %}
        {% csrf_token %}

    <!-- Series List -->
    <ion-card class="m-0">
        <ion-card-content class="p-0">
            <ion-list lines="full">
                {% for series in series_list %}
                <ion-item>
                    <div slot="start" class="w-12 h-12 flex items-center justify-center rounded-lg font-bold text-lg" style="background: var(--ion-color-primary-tint); color: var(--ion-color-primary);">
                        {{ series.prefix }}
                    </div>
                    <ion-label>
                        <h2>{{ series.name }}</h2>
                        <p>{{ series.description|default:_("No description") }}</p>
                        <p class="text-xs">
                            {% trans "Next number" %}: {{ series.prefix }}{{ series.current_number|stringformat:"06d" }}
                        </p>
                    </ion-label>
                    <div slot="end" class="flex items-center gap-2">
                        {% if series.is_default %}
                        <ion-badge color="primary">{% trans "Default" %}</ion-badge>
                        {% endif %}
                        {% if not series.is_active %}
                        <ion-badge color="medium">{% trans "Inactive" %}</ion-badge>
                        {% endif %}
                        <ion-button fill="clear" size="small"
                            hx-get="{% url 'invoicing:series_edit' series.id %}"
                            hx-target="#main-content-area"
                            hx-push-url="true">
                            <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                        </ion-button>
                        <ion-button fill="clear" color="danger" size="small"
                            hx-delete="{% url 'invoicing:series_delete' series.id %}"
                            hx-target="#main-content-area"
                            hx-confirm="{% trans 'Delete series' %} {{ series.prefix }}? {% trans 'This action cannot be undone.' %}"
                            hx-include="[name='csrfmiddlewaretoken']">
                            <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                        </ion-button>
                    </div>
                </ion-item>
                {% empty %}
                <ion-item>
                    <ion-label class="text-center py-8">
                        <ion-icon name="list-outline" style="font-size: 48px; color: var(--ion-color-medium);"></ion-icon>
                        <p class="mt-2" style="color: var(--ion-color-medium);">{% trans "No series created" %}</p>
                    </ion-label>
                </ion-item>
                {% endfor %}
            </ion-list>
        </ion-card-content>
    </ion-card>

    <!-- Info -->
    <div class="mt-6 p-4 rounded-lg" style="background: var(--ion-color-step-50);">
        <div class="flex items-start gap-2">
            <ion-icon name="information-circle-outline" style="font-size: 20px; color: var(--ion-color-primary); margin-top: 2px;"></ion-icon>
            <p class="text-sm" style="color: var(--ion-color-medium);">
                {% trans "Invoice series allow you to have different numbering sequences for different types of invoices. Each series has its own prefix (e.g., F for invoices, R for receipts) and auto-incrementing number." %}
            </p>
        </div>
    </div>
    {% endfill %}
{% endcomponent %}
